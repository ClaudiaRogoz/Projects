Merca Ionel 321 CB
Tema1 PC
Fiind cunoscute viteza conexiunii si timpul de propagare am calculat dimensiunea ferestrei glisante ca fiind (viteza conexiunii * timpul de propagare) / dimensiunea unui pachet in cazul nostru 1408. Pentru a folosi la maxim fereastra glisanta trebuie sa folosim o coada in care sa stocam elementele din fereastra, initial umplem coada cu pachete pe care le citim dintr-un fisier presupunem ca dimensiunea fisierului este indeajuns de mare, apoi trimitem toate pachetele din fereastra pentru ca in acest mod sa folosim la maxim legatura de date, in timpul in care ar trebui sa ajunga un acknowledge in loc sa asteptam trimitem dimenisunea ferestrei. Apoi dupa ce am trimis initial fereastra incepem sa asteptam ACK pentru pachetele care au fost trimise, daca primim ack modificam pozitia initiala a ferestrei glisante, si punem in fereastra noul pachet pe care il si trimitem. In receiver pentru primul caz daca primim pachetul pe care il asteptam adica are numarul de secventa egal cu un nrlast+1 care semnifica ultimul pachet primit atunci trimitem ACK si scriem in fisier acel pachet. 

Pentru cazul neideal cand se inregistreaza pierderi de pachete, trebuie sa verificam de fiecare data in send daca ack ul primit este cel asteptat. In cazul in care nu primim un ack corespunzator si este prima oara cand se intampla acest lucru marcam ca primit acel ack intr-un vector ackrecv care contine 0 sau 1 pe pozitiile pe care nu s-au primit sau s-au primit pachete, retrimitem pachetul/pachetele pe care nu le-am primit si le marcam ca neprimite, fereastra glisanta sta pe loc pana cand se primeste primul ack pierdut, nowack reprezinta pachetul pe care trebuie sa il primim deci updatam si aceasta variabila cu nr de secventa al ultimul pachet primit +1 in cazul in care nowack este mai mare decat numarul total de pachete din fereastra atunci pentru ca vectorul meu se comporta ca o coada, nowack se face 0 adica se duce in continuare. In cazul in care nu nr de secv primit este mai mic decat cel asteptam atunci retrimitem tot de la nr de secventa asteptam la numarul total de pachete, si de la 0 la numarul de secventa asteptat. 
In receiver daca pachetul primit este cel asteptat dar pana acum s-au pierdut pachete trebuie sa retinem pachetul respectiv intr-o coada, sa il marcam ca primit sa-l scriem in fisier pentru ca nu mutam fereastra glisanta pana cand nu se primeste primul pachet cu ack pierdut, si cautam daca mai sunt pachete imediat dupa el care pot fi scrise in fisier le scriem si pe acestea. Daca pachetul primit nu este cel asteptat marcam ca neprimite toate pachetele pana la el si in marcam pe el ca primit , in orice caz trimitem ack pentru pachetul primit.


Pentru a verifica fisierele corupte, tuturor pachetelor inainte sa le trimitem le calculam CRC ul in sender iar in cazul in care este diferit de cel calculat in receiver pachetul este corupt, trimitem NACK din receiver si in sender retrimitem pachetul. 

